function onYouTubeIframeAPIReady(){playerObject=new YT.Player("player",{height:"249",width:"442",videoId:"",playerVars:{iv_load_policy:3,controls:0,showinfo:0,showsearch:0,autoplay:1},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function debugMsg(e){DEBUG_MODE&&console.log("YouTubePlayer::"+e)}function onPlayerReady(e){debugMsg("onPlayerReady()");var a={};a.authenticate=getAuth(),connection.send(JSON.stringify(a)),debugMsg("onPlayerReady::connection.send("+JSON.stringify(a)+")"),readyEvent(),playerObject.setVolume(5)}function readyEvent(){debugMsg("readyEvent()");var e={};startPaused?e.status={readypause:!0}:e.status={ready:!0},connection.send(JSON.stringify(e)),debugMsg("readyEvent::connection.send("+JSON.stringify(e)+")")}function onPlayerStateChange(e){debugMsg("onPlayerStateChange("+e.data+")"),1===e.data&&startPaused&&(playerPaused=!0,playerObject.pauseVideo(),startPaused=!1);var a={};a.status={state:e.data},connection.send(JSON.stringify(a)),debugMsg("onPlayerStateChange::connection.send("+JSON.stringify(a)+")")}function handlePlayList(e){debugMsg("handlePlayList("+e+")"),$("#playlistTableTitle").html("Current Playlist: "+e.playlistname);var a="<tr><th /><th>Song Title</th><th>Duration</th><th>YouTube ID</th></tr>";for(var o in e.playlist){var i=e.playlist[o].song,n=e.playlist[o].title,r=e.playlist[o].duration;a+='<tr><td width="15"><divclass="button" onclick="deletePLSong(\''+i+'\')"><i class="fa fa-trash-o" /></div></td><td>'+n+"</td><td>"+r+"</td><td>"+i+"</td></tr>"}$("#playlistTable").html(a)}function handleSongList(e){debugMsg("handleSongList("+e+")");var a="<tr><th /><th /><th>Song Title</th><th>Requester</th><th>Duration</th><th>YouTube ID</th></tr>";for(var o in e.songlist){var i=e.songlist[o].song,n=e.songlist[o].title,r=e.songlist[o].duration,t=e.songlist[o].requester;a+='<tr>    <td width="15"><divclass="button" onclick="deleteSong(\''+i+'\')"><i class="fa fa-trash-o" /></div></td>    <td width="15"><divclass="button" onclick="stealSong(\''+i+'\')"><i class="fa fa-bookmark" /></div></td>    <td>'+n+"</td>    <td>"+t+"</td>    <td>"+r+'</td><td style="{width: 10%; text-align: right}">'+i+"</td></tr>"}$("#songTable").html(a)}function handlePlay(e,a,o,i){debugMsg("handlePlay("+e+", "+a+", "+o+", "+i+")");try{playerObject.loadVideoById(e,0,"medium"),newSongAlert("Now Playing",a,"success",4e3);var n="https://youtu.be/"+e;$("#currentSong").html('<div class="column center"></div><div class="column add-bottom"><div id="mainwrap"><div id="nowPlay"><span class="left" id="npAction">'+a+'</span><span class="right" id="npTitle"><a id="playerLink" href="" + ytLink + "">'+n+'</a></span></div><div id="songProgressBar"></div><div id="audiowrap"><div id="audio0"><span class="left">Duration: '+o+'</span><span class="right">Requested by '+i+'</span></div><div id="tracks"><a id="btnPrev" onclick="handlePause()">&rsaquo;</a><a id="btnNext" onclick="skipSong()">&raquo;</a></div></div><div id="songRequestDiv"</div></div>'),songRequestDiv(),$("#tooltip-random").tooltip(),$("#tooltip-steal").tooltip(),$("#tooltip-chat").tooltip(),$("#tooltip-sr").tooltip(),volumeSlider=$("#volumeControl").slider({min:0,max:100,value:currentVolume,range:"min",slide:function(e,a){handleSetVolume(a.value),handleCurrentVolume(currentVolume)}}).height(10),progressSlider=$("#songProgressBar").slider({min:0,max:playerObject.getDuration(),value:0,range:"min",stop:function(e,a){playerSeekSong(a.value)}}).height(5),playerMuted?$("#mutedDiv").html('<i class="fa fa-volume-off fa-lg" style="color: #000000" />'):$("#mutedDiv").html('<i class="fa fa-volume-off fa-lg" style="color: #ffffff" />'),playerPaused?$("#playPauseDiv").html('<i class="fa fa-pause" />'):$("#playPauseDiv").html('<i class="fa fa-play" />'),querySongList()}catch(r){console.log("YouTubePlayer::handlePlay::loadVideoById: "+r.message)}}function deleteSong(e){debugMsg("deleteSong("+e+")");var a={};a.deletesr=e,connection.send(JSON.stringify(a)),debugMsg("deleteSong::connection.send("+JSON.stringify(a)+")")}function deletePLSong(e){debugMsg("deletePLSong("+e+")");var a={};a.deletepl=e,connection.send(JSON.stringify(a)),debugMsg("deleteSong::connection.send("+JSON.stringify(a)+")")}function stealSong(e){debugMsg("stealSong()");var a={};a.command="stealsong",e&&(a.youTubeID=e),connection.send(JSON.stringify(a)),debugMsg("deleteSong::connection.send("+JSON.stringify(a)+")")}function toggleChat(){debugMsg("toggleChat()"),showChat?(showChat=!1,$(".chatFrame").hide()):(loadedChat||($(".chat").html('<iframe class="chatFrame" src="http://www.twitch.tv/'+getChannelName()+'/chat?popout=">'),loadedChat=!0),showChat=!0,$(".chatFrame").show())}function randomizePlaylist(e){debugMsg("randomizePlaylist()");var a={};a.command="togglerandom",connection.send(JSON.stringify(a)),debugMsg("deleteSong::connection.send("+JSON.stringify(a)+")")}function skipSong(e){debugMsg("skipSong()");var a={};a.command="skipsong",connection.send(JSON.stringify(a)),debugMsg("deleteSong::connection.send("+JSON.stringify(a)+")")}function handlePause(e){debugMsg("handlePause()"),playerPaused?(playerPaused=!1,playerObject.playVideo(),$("#playPauseDiv").html('<i class="fa fa-play" />')):(playerPaused=!0,playerObject.pauseVideo(),$("#playPauseDiv").html('<i class="fa fa-pause" />'))}function handleMute(e){debugMsg("handleMute()"),playerMuted?(playerMuted=!1,playerObject.unMute(),$("#mutedDiv").html('<i class="fa fa-volume-off fa-lg" style="color: #ffffff" />')):(playerMuted=!0,playerObject.mute(),$("#mutedDiv").html('<i class="fa fa-volume-off fa-lg" style="color: #000000" />'))}function handleCurrentId(e){debugMsg("handleCurrentId()");var a={};a.status={currentid:playerObject.getVideoUrl().match(/[?&]v=([^&]+)/)[1]},connection.send(JSON.stringify(a)),debugMsg("handleCurrentId::connection.send("+JSON.stringify(a)+")")}function handleSetVolume(e){debugMsg("handleSetVolume("+e+")"),currentVolume=e,playerObject.setVolume(e),null!=volumeSlider&&volumeSlider.slider("option","value",currentVolume)}function handleCurrentVolume(e){debugMsg("handleCurrentVolume()");var a={};a.status={volume:playerObject.getVolume()},connection.send(JSON.stringify(a)),debugMsg("handleCurrentVolume::connection.send("+JSON.stringify(a)+")")}function queryPlayList(){debugMsg("queryPlayList()");var e={};e.query="playlist",connection.send(JSON.stringify(e)),debugMsg("queryPlayList::connection.send("+JSON.stringify(e)+")")}function querySongList(){debugMsg("querySongList()");var e={};e.query="songlist",connection.send(JSON.stringify(e)),debugMsg("querySongList::connection.send("+JSON.stringify(e)+")")}function newSongAlert(e,a,o,i){debugMsg("newSongAlert("+e+", "+a+", "+o+", "+i+")"),$(".alert").fadeIn(1e3),$("#newSongAlert").show().html('<div class="alert alert-'+o+'"><button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button><span>'+e+" ["+a+"]</span></div>"),0!=i&&$(".alert-"+o).delay(i).fadeOut(1e3,function(){$(this).remove()})}function updateSongProgressBar(e){debugMsg("updateSongProgress: "+playerObject.getCurrentTime()),null!=progressSlider&&(progressSlider.slider("option","value",playerObject.getCurrentTime()),progressSlider.slider("option","max",playerObject.getDuration()))}function playerSeekSong(e){playerObject.seekTo(e,!0)}function songRequestDiv(){$("#songRequestDiv").html('<div class="modal fade" id="songRequestModal" aria-hidden="true">    <div class="modal-dialog">        <div class="modal-header">            <div class="modal-title" id="modalLabel">YouTube Song Request</div>         </div>         <div class="modal-body">             <form role="form" onkeypress="return event.keyCode != 13">                 <div class="form-group">                     <label for="songRequestInput">Search String / YouTube Link / YouTube ID</label>                     <input type="text" class="form-control" id="songRequestInput" placeholder="Song Request" />                 </div>             </form>         </div>         <div class="modal-footer">             <button type="button" class="btn btn-default" data-dismiss="modal" onclick="getFormSongRequest()">Submit</button>             <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>         </div>     </div></div>'),$("#songRequestDiv").on("hidden.bs.modal",function(){$("#songRequestInput").val("")})}function getFormSongRequest(){var e={};e.command="songrequest",e.search=$("#songRequestInput").val(),connection.send(JSON.stringify(e))}function sendKeepAlive(){var e={};if(connectedToWS){e.status={state:200};try{connection.send(JSON.stringify(e)),connectedToWS=!0}catch(a){console.log("YouTubePlayer::sendKeepAlive::exception: "+a.message)}}}var DEBUG_MODE=!1,startPaused=!1,playerPaused=!1,playerMuted=!1,connectedToWS=!1,showChat=!1,loadedChat=!1,volumeSlider=null,progressSlider=null,url=window.location.host.split(":"),addr="ws://"+url[0]+":"+getPlayerPort(),connection=new WebSocket(addr,[]),currentVolume=0;-1!==window.location.href.indexOf("start_paused")&&(startPaused=!0);var documentElement=document.createElement("script");documentElement.src="https://www.youtube.com/iframe_api";var scriptTag=document.getElementsByTagName("script")[0];scriptTag.parentNode.insertBefore(documentElement,scriptTag);var playerObject;connection.onopen=function(e){debugMsg("connection.onopen()"),connectedToWS=!0},connection.onclose=function(e){debugMsg("connection.onclose()"),newSongAlert("WebSocket has been closed","Restart player when bot is restored","danger",0),connectedToWS=!1},connection.onmessage=function(e){try{var a=JSON.parse(e.data)}catch(o){return void console.log("YouTubePlayer::connection.onmessage: badJson("+e.data+"): "+o.message)}debugMsg("connection.onmessage("+e.data+")");{if(0!=a.authresult){if(a.command){if(a.command.play)return void handlePlay(a.command.play,a.command.title,a.command.duration,a.command.requester);if(a.command.setvolume)return void handleSetVolume(parseInt(a.command.setvolume));if(0==a.command.localeCompare("pause"))return void handlePause(a.command);if(0==a.command.localeCompare("querysong"))return void handleQuerySong(a.command)}return a.songlist?void handleSongList(a):a.playlist?void handlePlayList(a):void console.log("YouTubePlayer::connection.onmessage: unknownJson("+e.data+")")}if(!a.authresult)return void newSongAlert("WS Auth Failed","Reload page, if that fails, restart bot","danger",0)}},setInterval(updateSongProgressBar,2e3),setInterval(sendKeepAlive,2e4);