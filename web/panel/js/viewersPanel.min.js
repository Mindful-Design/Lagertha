!function(){function T(e){var a=parseInt(e),n=0,r=0,t=0,s="",l=function(e){return 10>e?"0"+e:e};return a>86400?(n=a/86400,a%=86400,s+=l(Math.floor(n))+":"):s+="00:",a>3600?(r=a/3600,a%=3600,s+=l(Math.floor(r))+":"):s+="00:",t=a/60,s+=l(Math.floor(t))}function f(e){return void 0==e?"No Data":$.format.date(parseInt(e),"MM.dd.yy hh:mm:ss")}function k(e){var a,k="",M="";htmlData=[];try{a=JSON.parse(e.data)}catch(C){return}if(panelHasQuery(a)){if(0===a.query_id.indexOf("viewers_"))for(B in a.results){var A=a.results[B].key,b=a.results[B].value;void 0===u[A]&&u.push(A),panelCheckQuery(a,"viewers_groups")&&(h[A]=b,0==b.indexOf("0")&&(h[A]="1")),panelCheckQuery(a,"viewers_time")&&(c[A]=b),panelCheckQuery(a,"viewers_points")&&(m[A]=b),panelCheckQuery(a,"viewers_lastseen")&&(d[A]=b),panelCheckQuery(a,"viewers_timeout")&&(S[A]=b),panelCheckQuery(a,"viewers_chat")&&(g[A]=b),panelCheckQuery(a,"viewers_followed")&&(p[A]=b)}if(i=i?!0:panelCheckQuery(a,"viewers_groups"),n=n?!0:panelCheckQuery(a,"viewers_time"),r=r?!0:panelCheckQuery(a,"viewers_points"),o=o?!0:panelCheckQuery(a,"viewers_lastseen"),l=l?!0:panelCheckQuery(a,"viewers_followed"),s=s?!0:panelCheckQuery(a,"viewers_timeout"),t=t?!0:panelCheckQuery(a,"viewers_chat"),o&&i&&n&&r&&l&&(!panelStatsEnabled||panelStatsEnabled&&t&&s)){u.sort(D);for(var B in u)k=u[B],void 0==h[k]&&(h[k]="7"),panelIsDefined(m[k])||(m[k]="0"),panelIsDefined(S[k])||(S[k]="0"),panelIsDefined(g[k])||(g[k]="0"),panelIsDefined(p[k])||(p[k]="false"),panelIsDefined(c[k])||(c[k]="0"),y[k]={group:h[k],time:c[k],points:m[k],lastseen:d[k],followed:p[k],timeout:panelStatsEnabled?S[k]:0,chat:panelStatsEnabled?g[k]:0};M="<table class='CLASS_STRING table table-hover table-striped' data-paging='true' data-paging-size='8'       data-filtering='true' data-filter-delay='200'       data-sorting='true'       data-paging-count-format='Rows {PF}-{PL} / {TR}' data-show-header='true'><thead><tr>    <th data-breakpoints='xs'>User</th>    <th data-type='Date'>Last Seen</th>    <th data-type='Date'>Time in Chat</th>    <th data-type='number' data-container='body' data-toggle='tooltip' title='Points'><i class='fa fa-money' /></th>    <th data-type='number' data-container='body' data-toggle='tooltip' title='Messages'><i class='fa fa-comment' /></th>    <th data-type='number' data-container='body' data-toggle='tooltip' title='Bans'><i class='fa fa-ban' /></th>    <th data-toggle='tooltip' data-container='body' title='Promotions'><i class='fa fa-heart' /></th></tr></thead><tbody>",htmlData[1]=M.replace("CLASS_STRING","table_1"),htmlData[2]=M.replace("CLASS_STRING","table_2"),htmlData[3]=M.replace("CLASS_STRING","table_3"),htmlData[4]=M.replace("CLASS_STRING","table_4"),htmlData[6]=M.replace("CLASS_STRING","table_6"),htmlData[7]=M.replace("CLASS_STRING","table_7");for(var k in y)htmlData[y[k].group.toString()]+="<tr >    <td>"+k+"</td>    <td>"+f(y[k].lastseen)+"</td>    <td>"+T(y[k].time)+"</td>    <td>"+y[k].points+"</td>",panelStatsEnabled?htmlData[y[k].group.toString()]+="    <td>"+y[k].chat+"</td>    <td>"+y[k].timeout+"</td>":htmlData[y[k].group.toString()]+="    <td>0</td>    <td>0</td>",0===panelStrcmp(y[k].followed,"true")?htmlData[y[k].group.toString()]+="    <td>&hearts;</td>":htmlData[y[k].group.toString()]+="    <td>&nbsp;</td>",htmlData[y[k].group.toString()]+="</tr>";htmlData[1]+="</tbody></table>",htmlData[2]+="</tbody></table>",htmlData[3]+="</tbody></table>",htmlData[4]+="</tbody></table>",htmlData[6]+="</tbody></table>",htmlData[7]+="</tbody></table>",$("#viewersAdminList").html(htmlData[1]),$(".table_1").footable(),$("#viewersModList").html(htmlData[2]),$(".table_2").footable(),$("#viewersSubList").html(htmlData[3]),$(".table_3").footable(),$("#viewersDonatorList").html(htmlData[4]),$(".table_4").footable(),$("#viewersRegList").html(htmlData[6]),$(".table_6").footable(),$("#viewersViewerList").html(htmlData[7]),$(".table_7").footable(),i=!1,n=!1,r=!1,o=!1,s=!1,t=!1,l=!1,d=[],h=[],c=[],m=[],g=[],S=[],p=[],y=[],u=[],htmlData=[]}}}function M(){sendDBKeys("viewers_lastseen","lastseen"),sendDBKeys("viewers_groups","group"),sendDBKeys("viewers_time","time"),sendDBKeys("viewers_points","points"),sendDBKeys("viewers_followed","followed"),sendDBKeys("viewers_visited","visited"),panelStatsEnabled&&(sendDBKeys("viewers_timeout","panelmoduserstats"),sendDBKeys("viewers_chat","panelchatuserstats")),$("#viewersAdminList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersModList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersSubList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersDonatorList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersRegList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersViewerList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>")}function D(e,a){return panelStrcmp(e,a)}function A(e){var a=$("#promoteUser"+e).val();0!=a.length&&("Admin"==e&&(sendDBUpdate("user_perm","group",a.toLowerCase(),"1"),sendCommand("permissionsetuser "+a.toLowerCase()+" 1")),"Mod"==e&&(sendDBUpdate("user_perm","group",a.toLowerCase(),"2"),sendCommand("permissionsetuser "+a.toLowerCase()+" 2")),"Sub"==e&&(sendDBUpdate("user_perm","group",a.toLowerCase(),"3"),sendCommand("permissionsetuser "+a.toLowerCase()+" 3")),"Donator"==e&&(sendDBUpdate("user_perm","group",a.toLowerCase(),"4"),sendCommand("permissionsetuser "+a.toLowerCase()+" 4")),"Reg"==e&&(sendDBUpdate("user_perm","group",a.toLowerCase(),"6"),sendCommand("permissionsetuser "+a.toLowerCase()+" 6"))),$("#promoteUser"+e).val(""),M()}function b(e){var a=$("#unPromoteUser"+e).val();0!=a.length&&(sendDBDelete("user_perm","group",a.toLowerCase()),sendCommand("permissionsetuser "+a.toLowerCase()+" 7")),$("#unPromoteUser"+e).val(""),M()}function B(){var e=$("#fixFollower").val();0!=e.length&&sendDBUpdate("user_follows","followed",e.toLowerCase(),"true"),$("#fixFollower").val(""),M()}var e=[];e["false"]='<i class="fa fa-circle text-warning" />',e["true"]='<i class="fa fa-circle text-success" />';var a=[];a[0]="Caster",a[1]="Admin",a[2]="Moderator",a[3]="Subscriber",a[4]="Donator",a[6]="Regular",a[7]="Viewer";var o=!1,i=!1,n=!1,r=!1,t=!1,s=!1,l=!1,u=[],d=[],h=[],c=[],m=[],g=[],S=[],p=[],y={};$("#viewersPanel").load("/panel/viewers.html");var P=setInterval(function(){if(isConnected&&TABS_INITIALIZED){var e=$("#tabs").tabs("option","active");7==e&&(M(),clearInterval(P))}},INITIAL_WAIT_TIME);$.viewersOnMessage=k,$.viewersDoQuery=M,$.updateUserPerm=A,$.demoteUser=b,$.fixFollower=B}();