(function(){function e(e){var t=parseInt(e),a=0,s=0,r=0,n="",o=function(e){return e<10?"0"+e:e};return t>86400?(a=t/86400,t%=86400,n+=o(Math.floor(a))+":"):n+="00:",t>3600?(s=t/3600,t%=3600,n+=o(Math.floor(s))+":"):n+="00:",r=t/60,n+=o(Math.floor(r))}function t(e){return void 0==e?"No Data":$.format.date(parseInt(e),"MM.dd.yy hh:mm:ss")}function a(a){var s,r="",n="";htmlData=[];try{s=JSON.parse(a.data)}catch(e){return}if(panelHasQuery(s)){if(0===s.query_id.indexOf("viewers_"))for(d in s.results){var l=s.results[d].key,i=s.results[d].value;void 0===D[l]&&D.push(l),panelCheckQuery(s,"viewers_groups")&&(g[l]=i,0==i.indexOf("0")&&(g[l]="1")),panelCheckQuery(s,"viewers_time")&&(y[l]=i),panelCheckQuery(s,"viewers_points")&&(C[l]=i),panelCheckQuery(s,"viewers_lastseen")&&(_[l]=i),panelCheckQuery(s,"viewers_timeout")&&(L[l]=i),panelCheckQuery(s,"viewers_chat")&&(S[l]=i),panelCheckQuery(s,"viewers_followed")&&(I[l]=i)}if(m=!!m||panelCheckQuery(s,"viewers_groups"),f=!!f||panelCheckQuery(s,"viewers_time"),c=!!c||panelCheckQuery(s,"viewers_points"),h=!!h||panelCheckQuery(s,"viewers_lastseen"),v=!!v||panelCheckQuery(s,"viewers_followed"),w=!!w||panelCheckQuery(s,"viewers_timeout"),b=!!b||panelCheckQuery(s,"viewers_chat"),h&&m&&f&&c&&v&&(!panelStatsEnabled||panelStatsEnabled&&b&&w)){D.sort(o);for(var d in D)r=D[d],void 0==g[r]&&(g[r]="7"),panelIsDefined(C[r])||(C[r]="0"),panelIsDefined(L[r])||(L[r]="0"),panelIsDefined(S[r])||(S[r]="0"),panelIsDefined(I[r])||(I[r]="false"),panelIsDefined(y[r])||(y[r]="0"),k[r]={group:g[r],time:y[r],points:C[r],lastseen:_[r],followed:I[r],timeout:panelStatsEnabled?L[r]:0,chat:panelStatsEnabled?S[r]:0};n="<table class='CLASS_STRING table table-hover table-striped' data-paging='true' data-paging-size='8'       data-filtering='true' data-filter-delay='200'       data-sorting='true'       data-paging-count-format='Rows {PF}-{PL} / {TR}' data-show-header='true'><thead><tr>    <th data-breakpoints='xs'>User</th>    <th data-type='Date'>Last Seen</th>    <th data-type='Date'>Time in Chat</th>    <th data-type='number' data-container='body' data-toggle='tooltip' title='Points'><i class='fa fa-money' /></th>    <th data-type='number' data-container='body' data-toggle='tooltip' title='Messages'><i class='fa fa-comment' /></th>    <th data-type='number' data-container='body' data-toggle='tooltip' title='Bans'><i class='fa fa-ban' /></th>    <th data-toggle='tooltip' data-container='body' title='Promotions'><i class='fa fa-heart' /></th></tr></thead><tbody>",htmlData[1]=n.replace("CLASS_STRING","table_1"),htmlData[2]=n.replace("CLASS_STRING","table_2"),htmlData[3]=n.replace("CLASS_STRING","table_3"),htmlData[4]=n.replace("CLASS_STRING","table_4"),htmlData[6]=n.replace("CLASS_STRING","table_6"),htmlData[7]=n.replace("CLASS_STRING","table_7");for(var r in k)htmlData[k[r].group.toString()]+="<tr >    <td>"+r+"</td>    <td>"+t(k[r].lastseen)+"</td>    <td>"+e(k[r].time)+"</td>    <td>"+k[r].points+"</td>",panelStatsEnabled?htmlData[k[r].group.toString()]+="    <td>"+k[r].chat+"</td>    <td>"+k[r].timeout+"</td>":htmlData[k[r].group.toString()]+="    <td>0</td>    <td>0</td>",0===panelStrcmp(k[r].followed,"true")?htmlData[k[r].group.toString()]+="    <td>&hearts;</td>":htmlData[k[r].group.toString()]+="    <td>&nbsp;</td>",htmlData[k[r].group.toString()]+="</tr>";htmlData[1]+="</tbody></table>",htmlData[2]+="</tbody></table>",htmlData[3]+="</tbody></table>",htmlData[4]+="</tbody></table>",htmlData[6]+="</tbody></table>",htmlData[7]+="</tbody></table>",$("#viewersAdminList").html(htmlData[1]),$(".table_1").footable(),$("#viewersModList").html(htmlData[2]),$(".table_2").footable(),$("#viewersSubList").html(htmlData[3]),$(".table_3").footable(),$("#viewersDonatorList").html(htmlData[4]),$(".table_4").footable(),$("#viewersRegList").html(htmlData[6]),$(".table_6").footable(),$("#viewersViewerList").html(htmlData[7]),$(".table_7").footable(),m=!1,f=!1,c=!1,h=!1,w=!1,b=!1,v=!1,_=[],g=[],y=[],C=[],S=[],L=[],I=[],k=[],D=[],htmlData=[]}}}function s(){}function r(){var e,t="",a='<table class="table table-hover table-striped">',s="",r=!1;if(panelCheckQuery(e,"commands_cooldown")){a='<table class="table table-hover table-striped">';for(idx in e.results)t=e.results[idx].key,s=JSON.parse(e.results[idx].value).seconds,r=!0,a+="<tr >    <td>!"+t+'</td>    <td>        <form onkeypress="return event.keyCode != 13">            <input type="text" id="editCommandCooldown_'+t.replace(/[^a-zA-Z0-9_]/g,"_SP_")+'"                   value="'+s+" seconds. (Global: "+JSON.parse(e.results[idx].value).isGlobal+')" disabled/>              <button type="button" class="btn btn-default btn-fill btn-xs" onclick="$.editCooldown(\''+t+'\')"><i class="fa fa-pencil" /> </button>               <button type="button" class="btn btn-danger btn-xs" id="deleteCooldown_'+t+'" onclick="$.deleteCooldown(\''+t+'\')"><i class="fa fa-trash" /> </button>             </form>        </form>    </td></tr>';a+="</table>",r||(a="<i>No entries in mod table.</i>"),$("#viewersModList").html(a)}}function n(){sendDBKeys("viewers_lastseen","lastseen"),sendDBKeys("viewers_groups","group"),sendDBKeys("viewers_time","time"),sendDBKeys("viewers_points","points"),sendDBKeys("viewers_followed","followed"),sendDBKeys("viewers_visited","visited"),panelStatsEnabled&&(sendDBKeys("viewers_timeout","panelmoduserstats"),sendDBKeys("viewers_chat","panelchatuserstats")),$("#viewersAdminList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersModList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersSubList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersDonatorList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersRegList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>"),$("#viewersViewerList").html("Refreshing Data <i class='fa fa-spinner fa-spin' aria-hidden='true'></i>")}function o(e,t){return panelStrcmp(e,t)}function l(e){var t=$("#promoteUser"+e).val();0!=t.length&&("Admin"==e&&(sendDBUpdate("user_perm","group",t.toLowerCase(),"1"),sendCommand("permissionsetuser "+t.toLowerCase()+" 1")),"Mod"==e&&(sendDBUpdate("user_perm","group",t.toLowerCase(),"2"),sendCommand("permissionsetuser "+t.toLowerCase()+" 2")),"Sub"==e&&(sendDBUpdate("user_perm","group",t.toLowerCase(),"3"),sendCommand("permissionsetuser "+t.toLowerCase()+" 3")),"Donator"==e&&(sendDBUpdate("user_perm","group",t.toLowerCase(),"4"),sendCommand("permissionsetuser "+t.toLowerCase()+" 4")),"Reg"==e&&(sendDBUpdate("user_perm","group",t.toLowerCase(),"6"),sendCommand("permissionsetuser "+t.toLowerCase()+" 6"))),$("#promoteUser"+e).val(""),n()}function i(e){var t=$("#unPromoteUser"+e).val();0!=t.length&&(sendDBDelete("user_perm","group",t.toLowerCase()),sendCommand("permissionsetuser "+t.toLowerCase()+" 7")),$("#unPromoteUser"+e).val(""),n()}function d(){var e=$("#fixFollower").val();0!=e.length&&sendDBUpdate("user_follows","followed",e.toLowerCase(),"true"),$("#fixFollower").val(""),n()}var p=[];p.false='<i class="fa fa-circle text-warning" />',p.true='<i class="fa fa-circle text-success" />';var u=[];u[0]="Caster",u[1]="Admin",u[2]="Moderator",u[3]="Subscriber",u[4]="Donator",u[6]="Regular",u[7]="Viewer";var h=!1,m=!1,f=!1,c=!1,b=!1,w=!1,v=!1,D=[],_=[],g=[],y=[],C=[],S=[],L=[],I=[],k={};$("#viewersPanel").load("/panel/viewers.html");var R=setInterval(function(){if(isConnected&&TABS_INITIALIZED){var e=$("#tabs").tabs("option","false");7==e&&(n(),clearInterval(R))}},INITIAL_WAIT_TIME);$.showTable1=s,$.showTable2=r,$.viewersOnMessage=a,$.viewersDoQuery=n,$.updateUserPerm=l,$.demoteUser=i,$.fixFollower=d})();