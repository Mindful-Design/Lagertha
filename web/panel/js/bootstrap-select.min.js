!function(e){var t=function(i,s,n){n&&(n.stopPropagation(),n.preventDefault()),this.$element=e(i),this.$newElement=null,this.button=null,this.options=e.extend({},e.fn.selectpicker.defaults,this.$element.data(),"object"==typeof s&&s),null==this.options.title&&(this.options.title=this.$element.attr("title")),this.val=t.prototype.val,this.render=t.prototype.render,this.init()};t.prototype={constructor:t,init:function(t){var i=this;this.$element.hide(),this.multiple=this.$element.prop("multiple");var s=void 0!==this.$element.attr("class")?this.$element.attr("class").split(/\s+/):"",n=this.$element.attr("id");this.$element.after(this.createView()),this.$newElement=this.$element.next(".select");var r=this.$newElement,a=this.$newElement.find(".dropdown-menu"),o=this.$newElement.find(".dropdown-arrow"),h=(a.find("li > a"),r.addClass("open").find(".dropdown-menu li > a").outerHeight());r.removeClass("open");var u=a.find("li .divider").outerHeight(!0),c=this.$newElement.offset().top,d=0,p=this.$newElement.outerHeight();this.button=this.$newElement.find("> button"),void 0!==n&&(this.button.attr("id",n),e('label[for="'+n+'"]').click(function(){r.find("button#"+n).focus()}));for(var m=0;m<s.length;m++)"selectpicker"!=s[m]&&this.$newElement.addClass(s[m]);this.multiple&&this.$newElement.addClass("select-multiple"),this.button.addClass(this.options.style),a.addClass(this.options.menuStyle),o.addClass(function(){return i.options.menuStyle?i.options.menuStyle.replace("dropdown-","dropdown-arrow-"):void 0}),this.checkDisabled(),this.checkTabIndex(),this.clickListener();var g=parseInt(a.css("padding-top"))+parseInt(a.css("padding-bottom"))+parseInt(a.css("border-top-width"))+parseInt(a.css("border-bottom-width"));if("auto"==this.options.size){var v=debounce(function(){var t=c-e(window).scrollTop(),i=e(window).innerHeight(),s=g+parseInt(a.css("margin-top"))+parseInt(a.css("margin-bottom"))+2,n=i-t-p-s;d=n,r.hasClass("dropup")&&(d=t-s),d>=300&&(d=300),a.css({"max-height":d+"px","overflow-y":"auto","min-height":3*h+"px"})},50);e(window).on("scroll",v),e(window).on("resize",v),window.MutationObserver?new MutationObserver(v).observe(this.$element.get(0),{childList:!0}):this.$element.bind("DOMNodeInserted",v)}else if(this.options.size&&"auto"!=this.options.size&&a.find("li").length>this.options.size){var b=a.find("li > *").filter(":not(.divider)").slice(0,this.options.size).last().parent().index(),_=a.find("li").slice(0,b+1).find(".divider").length;d=h*this.options.size+_*u+g,a.css({"max-height":d+"px","overflow-y":"scroll"})}window.MutationObserver?new MutationObserver(e.proxy(this.reloadLi,this)).observe(this.$element.get(0),{childList:!0}):this.$element.bind("DOMNodeInserted",e.proxy(this.reloadLi,this)),this.render()},createDropdown:function(){var t="<div class='btn-group select'><button class='btn dropdown-toggle clearfix' data-toggle='dropdown'><span class='filter-option'></span>&nbsp;<span class='caret'></span></button><span class='dropdown-arrow'></span><ul class='dropdown-menu' role='menu'></ul></div>";return e(t)},createView:function(){var e=this.createDropdown(),t=this.createLi();return e.find("ul").append(t),e},reloadLi:function(){this.destroyLi(),$li=this.createLi(),this.$newElement.find("ul").append($li),this.render()},destroyLi:function(){this.$newElement.find("li").remove()},createLi:function(){var t=this,i=[],s=[],n="";if(this.$element.find("option").each(function(){i.push(e(this).text())}),this.$element.find("option").each(function(i){var n=void 0!==e(this).attr("class")?e(this).attr("class"):"",r=e(this).text(),a=void 0!==e(this).data("subtext")?'<small class="muted">'+e(this).data("subtext")+"</small>":"";if(r+=a,e(this).parent().is("optgroup")&&1!=e(this).data("divider"))if(0==e(this).index()){var o=e(this).parent().attr("label"),l=void 0!==e(this).parent().data("subtext")?'<small class="muted">'+e(this).parent().data("subtext")+"</small>":"";o+=l,0!=e(this)[0].index?s.push('<div class="divider"></div><dt>'+o+"</dt>"+t.createA(r,"opt "+n)):s.push("<dt>"+o+"</dt>"+t.createA(r,"opt "+n))}else s.push(t.createA(r,"opt "+n));else 1==e(this).data("divider")?s.push('<div class="divider"></div>'):1==e(this).data("hidden")?s.push(""):s.push(t.createA(r,n))}),i.length>0)for(var r=0;r<i.length;r++){this.$element.find("option").eq(r);n+="<li rel="+r+">"+s[r]+"</li>"}return 0!=this.$element.find("option:selected").length||t.options.title||this.$element.find("option").eq(0).prop("selected",!0).attr("selected","selected"),e(n)},createA:function(e,t){return'<a tabindex="-1" href="#" class="'+t+'"><span class="">'+e+"</span></a>"},render:function(){var t=this;if("auto"==this.options.width){var i=this.$newElement.find(".dropdown-menu").css("width");this.$newElement.css("width",i)}else this.options.width&&"auto"!=this.options.width&&this.$newElement.css("width",this.options.width);this.$element.find("option").each(function(i){t.setDisabled(i,e(this).is(":disabled")||e(this).parent().is(":disabled")),t.setSelected(i,e(this).is(":selected"))});var s=this.$element.find("option:selected").map(function(t,i){return void 0!=e(this).attr("title")?e(this).attr("title"):e(this).text()}).toArray(),n=s.join(", ");if(t.multiple&&t.options.selectedTextFormat.indexOf("count")>-1){var r=t.options.selectedTextFormat.split(">");(r.length>1&&s.length>r[1]||1==r.length&&s.length>=2)&&(n=s.length+" of "+this.$element.find("option").length+" selected")}n||(n=void 0!=t.options.title?t.options.title:t.options.noneSelectedText),this.$element.next(".select").find(".filter-option").html(n)},setSelected:function(e,t){t?this.$newElement.find("li").eq(e).addClass("selected"):this.$newElement.find("li").eq(e).removeClass("selected")},setDisabled:function(e,t){t?this.$newElement.find("li").eq(e).addClass("disabled"):this.$newElement.find("li").eq(e).removeClass("disabled")},checkDisabled:function(){this.$element.is(":disabled")&&(this.button.addClass("disabled"),this.button.click(function(e){e.preventDefault()}))},checkTabIndex:function(){if(this.$element.is("[tabindex]")){var e=this.$element.attr("tabindex");this.button.attr("tabindex",e)}},clickListener:function(){var t=this;e("body").on("touchstart.dropdown",".dropdown-menu",function(e){e.stopPropagation()}),this.$newElement.on("click","li a",function(i){var s=e(this).parent().index(),n=e(this).parent(),r=n.parents(".select");if(t.multiple&&i.stopPropagation(),i.preventDefault(),r.prev("select").not(":disabled")&&!e(this).parent().hasClass("disabled")){if(t.multiple){var a=r.prev("select").find("option").eq(s).prop("selected");a?r.prev("select").find("option").eq(s).removeAttr("selected"):r.prev("select").find("option").eq(s).prop("selected",!0).attr("selected","selected")}else r.prev("select").find("option").removeAttr("selected"),r.prev("select").find("option").eq(s).prop("selected",!0).attr("selected","selected");r.find(".filter-option").html(n.text()),r.find("button").focus(),r.prev("select").trigger("change")}}),this.$newElement.on("click","li.disabled a, li dt, li .divider",function(t){t.preventDefault(),t.stopPropagation(),$select=e(this).parent().parents(".select"),$select.find("button").focus()}),this.$element.on("change",function(e){t.render()})},val:function(e){return void 0!=e?(this.$element.val(e),this.$element.trigger("change"),this.$element):this.$element.val()}},e.fn.selectpicker=function(i,s){var r,n=arguments,a=this.each(function(){var a=e(this),o=a.data("selectpicker"),l="object"==typeof i&&i;if(o)for(var h in i)o[h]=i[h];else a.data("selectpicker",o=new t(this,l,s));"string"==typeof i&&(property=i,o[property]instanceof Function?([].shift.apply(n),r=o[property].apply(o,n)):r=o[property])});return void 0!=r?r:a},e.fn.selectpicker.defaults={style:null,size:"auto",title:null,selectedTextFormat:"values",noneSelectedText:"Nothing selected",width:null,menuStyle:null,toggleSize:null}}(window.jQuery);