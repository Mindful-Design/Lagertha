!function(e){var t=function(i,n,a){a&&(a.stopPropagation(),a.preventDefault()),this.$element=e(i),this.$newElement=null,this.button=null,this.options=e.extend({},e.fn.selectpicker.defaults,this.$element.data(),"object"==typeof n&&n),null==this.options.title&&(this.options.title=this.$element.attr("title")),this.val=t.prototype.val,this.render=t.prototype.render,this.init()};t.prototype={constructor:t,init:function(t){var i=this;this.$element.hide(),this.multiple=this.$element.prop("multiple");var n=void 0!==this.$element.attr("class")?this.$element.attr("class").split(/\s+/):"",a=this.$element.attr("id");this.$element.after(this.createView()),this.$newElement=this.$element.next(".select");var o=this.$newElement,s=this.$newElement.find(".dropdown-menu"),r=this.$newElement.find(".dropdown-arrow"),u=(s.find("li > a"),o.addClass("open").find(".dropdown-menu li > a").outerHeight());o.removeClass("open");var h=s.find("li .divider").outerHeight(!0),c=this.$newElement.offset().top,f=0,p=this.$newElement.outerHeight();this.button=this.$newElement.find("> button"),void 0!==a&&(this.button.attr("id",a),e('label[for="'+a+'"]').click(function(){o.find("button#"+a).focus()}));for(var m=0;m<n.length;m++)"selectpicker"!=n[m]&&this.$newElement.addClass(n[m]);this.multiple&&this.$newElement.addClass("select-multiple"),this.button.addClass(this.options.style),s.addClass(this.options.menuStyle),r.addClass(function(){return i.options.menuStyle?i.options.menuStyle.replace("dropdown-","dropdown-arrow-"):void 0}),this.checkDisabled(),this.checkTabIndex(),this.clickListener();var g=parseInt(s.css("padding-top"))+parseInt(s.css("padding-bottom"))+parseInt(s.css("border-top-width"))+parseInt(s.css("border-bottom-width"));if("auto"==this.options.size){var y=debounce(function(){var t=c-e(window).scrollTop(),i=e(window).innerHeight(),n=g+parseInt(s.css("margin-top"))+parseInt(s.css("margin-bottom"))+2,a=i-t-p-n;f=a,o.hasClass("dropup")&&(f=t-n),f>=300&&(f=300),s.css({"max-height":f+"px","overflow-y":"auto","min-height":3*u+"px"})},50);e(window).on("scroll",y),e(window).on("resize",y),window.MutationObserver?new MutationObserver(y).observe(this.$element.get(0),{childList:!0}):this.$element.bind("DOMNodeInserted",y)}else if(this.options.size&&"auto"!=this.options.size&&s.find("li").length>this.options.size){var v=s.find("li > *").filter(":not(.divider)").slice(0,this.options.size).last().parent().index(),b=s.find("li").slice(0,v+1).find(".divider").length;f=u*this.options.size+b*h+g,s.css({"max-height":f+"px","overflow-y":"scroll"})}window.MutationObserver?new MutationObserver(e.proxy(this.reloadLi,this)).observe(this.$element.get(0),{childList:!0}):this.$element.bind("DOMNodeInserted",e.proxy(this.reloadLi,this)),this.render()},createDropdown:function(){var t="<div class='btn-group select'><button class='btn dropdown-toggle clearfix' data-toggle='dropdown'><span class='filter-option'></span>&nbsp;<span class='caret'></span></button><span class='dropdown-arrow'></span><ul class='dropdown-menu' role='menu'></ul></div>";return e(t)},createView:function(){var e=this.createDropdown(),t=this.createLi();return e.find("ul").append(t),e},reloadLi:function(){this.destroyLi(),$li=this.createLi(),this.$newElement.find("ul").append($li),this.render()},destroyLi:function(){this.$newElement.find("li").remove()},createLi:function(){var t=this,i=[],n=[],a="";if(this.$element.find("option").each(function(){i.push(e(this).text())}),this.$element.find("option").each(function(i){var a=void 0!==e(this).attr("class")?e(this).attr("class"):"",o=e(this).text(),s=void 0!==e(this).data("subtext")?'<small class="muted">'+e(this).data("subtext")+"</small>":"";if(o+=s,e(this).parent().is("optgroup")&&1!=e(this).data("divider"))if(0==e(this).index()){var r=e(this).parent().attr("label"),l=void 0!==e(this).parent().data("subtext")?'<small class="muted">'+e(this).parent().data("subtext")+"</small>":"";r+=l,0!=e(this)[0].index?n.push('<div class="divider"></div><dt>'+r+"</dt>"+t.createA(o,"opt "+a)):n.push("<dt>"+r+"</dt>"+t.createA(o,"opt "+a))}else n.push(t.createA(o,"opt "+a));else 1==e(this).data("divider")?n.push('<div class="divider"></div>'):1==e(this).data("hidden")?n.push(""):n.push(t.createA(o,a))}),i.length>0)for(var o=0;o<i.length;o++){this.$element.find("option").eq(o);a+="<li rel="+o+">"+n[o]+"</li>"}return 0!=this.$element.find("option:selected").length||t.options.title||this.$element.find("option").eq(0).prop("selected",!0).attr("selected","selected"),e(a)},createA:function(e,t){return'<a tabindex="-1" href="#" class="'+t+'"><span class="">'+e+"</span></a>"},render:function(){var t=this;if("auto"==this.options.width){var i=this.$newElement.find(".dropdown-menu").css("width");this.$newElement.css("width",i)}else this.options.width&&"auto"!=this.options.width&&this.$newElement.css("width",this.options.width);this.$element.find("option").each(function(i){t.setDisabled(i,e(this).is(":disabled")||e(this).parent().is(":disabled")),t.setSelected(i,e(this).is(":selected"))});var n=this.$element.find("option:selected").map(function(t,i){return void 0!=e(this).attr("title")?e(this).attr("title"):e(this).text()}).toArray(),a=n.join(", ");if(t.multiple&&t.options.selectedTextFormat.indexOf("count")>-1){var o=t.options.selectedTextFormat.split(">");(o.length>1&&n.length>o[1]||1==o.length&&n.length>=2)&&(a=n.length+" of "+this.$element.find("option").length+" selected")}a||(a=void 0!=t.options.title?t.options.title:t.options.noneSelectedText),this.$element.next(".select").find(".filter-option").html(a)},setSelected:function(e,t){t?this.$newElement.find("li").eq(e).addClass("selected"):this.$newElement.find("li").eq(e).removeClass("selected")},setDisabled:function(e,t){t?this.$newElement.find("li").eq(e).addClass("disabled"):this.$newElement.find("li").eq(e).removeClass("disabled")},checkDisabled:function(){this.$element.is(":disabled")&&(this.button.addClass("disabled"),this.button.click(function(e){e.preventDefault()}))},checkTabIndex:function(){if(this.$element.is("[tabindex]")){var e=this.$element.attr("tabindex");this.button.attr("tabindex",e)}},clickListener:function(){var t=this;e("body").on("touchstart.dropdown",".dropdown-menu",function(e){e.stopPropagation()}),this.$newElement.on("click","li a",function(i){var n=e(this).parent().index(),a=e(this).parent(),o=a.parents(".select");if(t.multiple&&i.stopPropagation(),i.preventDefault(),o.prev("select").not(":disabled")&&!e(this).parent().hasClass("disabled")){if(t.multiple){var s=o.prev("select").find("option").eq(n).prop("selected");s?o.prev("select").find("option").eq(n).removeAttr("selected"):o.prev("select").find("option").eq(n).prop("selected",!0).attr("selected","selected")}else o.prev("select").find("option").removeAttr("selected"),o.prev("select").find("option").eq(n).prop("selected",!0).attr("selected","selected");o.find(".filter-option").html(a.text()),o.find("button").focus(),o.prev("select").trigger("change")}}),this.$newElement.on("click","li.disabled a, li dt, li .divider",function(t){t.preventDefault(),t.stopPropagation(),$select=e(this).parent().parents(".select"),$select.find("button").focus()}),this.$element.on("change",function(e){t.render()})},val:function(e){return void 0!=e?(this.$element.val(e),this.$element.trigger("change"),this.$element):this.$element.val()}},e.fn.selectpicker=function(i,n){var o,a=arguments,s=this.each(function(){var s=e(this),r=s.data("selectpicker"),l="object"==typeof i&&i;if(r)for(var u in i)r[u]=i[u];else s.data("selectpicker",r=new t(this,l,n));"string"==typeof i&&(property=i,r[property]instanceof Function?([].shift.apply(a),o=r[property].apply(r,a)):o=r[property])});return void 0!=o?o:s},e.fn.selectpicker.defaults={style:null,size:"auto",title:null,selectedTextFormat:"values",noneSelectedText:"Nothing selected",width:null,menuStyle:null,toggleSize:null}}(window.jQuery);