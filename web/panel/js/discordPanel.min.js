(function(){function d(d){var e;try{e=JSON.parse(d.data)}catch(d){return void console.error("Failed to parse panel message [discordPanel.js]: "+d.message)}if(panelCheckQuery(e,"discord_gambling"))for(u in e.results)$("#gamble_"+e.results[u].key).val(e.results[u].value);if(panelCheckQuery(e,"discord_slotmachine"))for(u in e.results)$("#discordSlotRewards"+u+"Input").val(e.results[u].value);if(panelCheckQuery(e,"discord_roll"))for(u in e.results)$("#discordRollRewards"+u+"Input").val(e.results[u].value);if(panelCheckQuery(e,"discord_slotmachineemojis"))for(u in e.results)$("#slotEmoji"+u+"Input").val(e.results[u].value);if(panelCheckQuery(e,"discord_settings")){var o=e.results;for(u in o)"true"!==o[u].value&&"false"!==o[u].value&&"hostChannel"!==o[u].key?$("#"+o[u].key+"Input").val(o[u].value):"hostChannel"===o[u].key?$("#hostdChannelInput").val(o[u].value):$("#"+o[u].key+"Input").html(v[o[u].value])}if(panelCheckQuery(e,"discord_keywords")){var o=e.results,a="<table>";if(0===o.length)return void $("#keyword-list").html("<i>There are no keywords defined.</i>");for(u in o){var s=o[u].key,l=o[u].value;a+='<tr style="textList">    <td style="width: 15%">'+(s.length>10?s.substring(0,10)+"...":s)+'</td>    <td style="vertical-align: middle">        <form onkeypress="return event.keyCode != 13">            <input style="width: 90%" type="text" id="editKeyword_'+s.replace(/[^a-zA-Z0-9_]/g,"_SPC_")+'"                   value="'+l+'" />              <button style="float: right;" type="button" class="btn btn-default btn-xs" id="removeKeyword_'+s.replace(/[^a-zA-Z0-9_]/g,"_SPC_")+'" onclick="$.removeKeyword(\''+s+'\')"><i class="fa fa-trash" /> </button>              <button style="float: right;" type="button" class="btn btn-default btn-xs" onclick="$.editKeyword(\''+s+'\')"><i class="fa fa-pencil" /> </button>              </form>        </form>    </td></tr>'}a+="</table>",$("#keyword-list").html(a)}if(panelCheckQuery(e,"discord_commands")){var n,t,r,i,c,m,p,o=e.results,a='<table class="table table-hover table-striped"><tr><th>Command</th><th>Response</th><th>Cooldown</th><th style="float: right;"></td>',h={};if(0===o.length)return void $("#commands-list").html("<i>There are no commands defined.</i>");for(u in o)"discordPermcom"==o[u].table?void 0===h[o[u].key]?h[o[u].key]={permission:o[u].value}:h[o[u].key].permission=o[u].value:"discordCooldown"==o[u].table?void 0===h[o[u].key]?h[o[u].key]={cooldown:JSON.parse(o[u].value).seconds,isGlobal:"true"==JSON.parse(o[u].value).isGlobal}:(h[o[u].key].cooldown=JSON.parse(o[u].value).seconds,h[o[u].key].isGlobal="true"==JSON.parse(o[u].value).isGlobal):"discordChannelcom"==o[u].table?void 0===h[o[u].key]?h[o[u].key]={channel:o[u].value}:h[o[u].key].channel=o[u].value:"discordPricecom"==o[u].table?void 0===h[o[u].key]?h[o[u].key]={cost:o[u].value}:h[o[u].key].cost=o[u].value:"discordAliascom"==o[u].table&&(void 0===h[o[u].key]?h[o[u].key]={alias:o[u].value}:h[o[u].key].alias=o[u].value);for(u in o)"discordCommands"==o[u].table&&(c=o[u].key,i=o[u].value,n=h[c].permission,m=void 0!==h[c]&&void 0===h[c].channel?"":h[c].channel,r=void 0!==h[c]&&void 0===h[c].cooldown?0:h[c].cooldown,t=void 0!==h[c]&&void 0===h[c].cost?0:h[c].cost,p=void 0!==h[c]&&void 0===h[c].isGlobal||h[c].isGlobal,a+="<tr><td>!"+(c.length>10?c.substring(0,10)+"...":c)+"</td><td>"+(i.length>50?i.substring(0,50)+"...":i)+"</td><td>"+r+' sec </td><td><button type="button" class="btn btn-info btn-fill btn-xs" onclick="$.openCommandModal(\''+c+"', '"+i+"', '"+n+"', '"+t+"', '"+r+"', '"+m+"', '"+p+'\')"><i class="fa fa-pencil" /> </button><button type="button" id="delete_command_'+c.replace(/[^a-z1-9_]/gi,"_")+'" class="btn btn-info btn-fill btn-xs" onclick="$.updateDiscordCommand(\''+c+"', 'true')\"><i class=\"fa fa-trash\" /> </button></td> </tr>");a+="</table>",$("#command-list").html(a)}}function e(){sendDBKeys("discord_settings","discordSettings"),sendDBKeys("discord_keywords","discordKeywords"),sendDBKeys("discord_gambling","discordGambling"),sendDBKeys("discord_roll","discordRollReward"),sendDBKeys("discord_slotmachine","discordSlotMachineReward"),sendDBKeys("discord_slotmachineemojis","discordSlotMachineEmojis"),sendDBKeysList("discord_commands",["discordCommands","discordCooldown","discordPermcom","discordChannelcom"])}function o(d,o,a,s,l){var n=void 0!==l?l:$("#"+d).val();void 0!==l&&$("#"+d).html('<i  class="fa fa-spinner fa-spin"/>'),"string"==typeof n&&n.length>0||"number"==typeof n?("modLogs"==s&&("true"==l?sendDBUpdate("discord_update","chatModerator","moderationLogs","true"):sendDBUpdate("discord_update","chatModerator","moderationLogs","false")),console.log(a+":"+s+":"+n),sendDBUpdate("discord_update",a,s,String(n)),setTimeout(function(){sendWSEvent("discord","./discord/"+o),e()},TIMEOUT_WAIT_TIME)):setTimeout(function(){e()},TIMEOUT_WAIT_TIME)}function a(){$("#command-name-modal").val(""),$("#command-response-modal").val(""),$("#command-permission-modal").val(""),$("#command-cooldown-modal").val(""),$("#command-channel-modal").val(),$("#command-add-name-modal").val(""),$("#command-add-response-modal").val(""),$("#command-add-permission-modal").val("0"),$("#command-add-cooldown-modal").val("0"),$("#command-add-cost-modal").val("0"),$("#command-add-channel-modal").val(""),$("#command-add-global").prop("checked",!0),$("#command-edit-global").prop("checked",!0)}function s(d,o){if("string"==typeof o?"true"==o:1==o)$("#delete_command_"+d.replace(/[^a-z1-9_]/gi,"_")).html('<i  class="fa fa-spinner fa-spin"/>'),sendDBDelete("discord_command","discordCommands",d),sendDBDelete("discord_command","discordPermcom",d),sendDBDelete("discord_command","discordCooldown",d),sendDBDelete("discord_command","discordChannelcom",d),sendDBDelete("discord_command","discordPricecom",d),sendDBDelete("discord_command","discordAliascom",d),sendWSEvent("discord","./discord/commands/customCommands.js","remove",[d]);else{var s=0===$("#command-name-modal").val().length?$("#command-add-name-modal").val():$("#command-name-modal").val(),l=0===$("#command-response-modal").val().length?$("#command-add-response-modal").val():$("#command-response-modal").val(),n=0===$("#command-permission-modal").val().length?$("#command-add-permission-modal").val():$("#command-permission-modal").val(),t=0===$("#command-cooldown-modal").val().length?$("#command-add-cooldown-modal").val():$("#command-cooldown-modal").val(),r=0===$("#command-channel-modal").val().length?$("#command-add-channel-modal").val():$("#command-channel-modal").val(),i=0===$("#command-cost-modal").val().length?$("#command-add-cost-modal").val():$("#command-cost-modal").val(),c=0===$("#command-alias-modal").val().length?$("#command-add-alias-modal").val():$("#command-alias-modal").val(),m=$("#command-add-global").is(":checked");if(0===s.length||0===l.length||s.match(/[\'\"\s]/gi)||1!=n&&0!=n)return setTimeout(function(){e(),a()},TIMEOUT_WAIT_TIME),void newPanelAlert("Could not add command !"+s+". Either the response was blank, the permission was invalid, or it contained a special symbol.","danger",1e4);s=s.replace("!","").toLowerCase(),c=c.replace("!","").toLowerCase(),sendDBUpdate("discord_command","discordCommands",s,l.toString()),sendDBUpdate("discord_command","discordPermcom",s,n.toString()),sendDBUpdate("discord_command","discordCooldown",s,JSON.stringify({command:String(s),seconds:String(t),isGlobal:String(m)})),sendDBUpdate("discord_command","discordPricecom",s,i.toString()),0===r.length&&sendDBDelete("discord_command","discordChannelcom",s),c.length>0?sendDBUpdate("discord_command","discordAliascom",s,c.toString()):sendDBDelete("discord_command","discordAliascom",s),setTimeout(function(){sendWSEvent("discord","./discord/commands/customCommands.js",null,[s,n,r,c,i])},TIMEOUT_WAIT_TIME)}setTimeout(function(){e(),a()},TIMEOUT_WAIT_TIME)}function l(d,e,o,a,s,l,n){$("#command-name-modal").val(d),$("#command-response-modal").val(e.replace(/&#39;/g,"'")),$("#command-permission-modal").val(o),$("#command-cooldown-modal").val(s),$("#command-channel-modal").val(l),$("#command-cost-modal").val(a),$("#command-edit-global").prop("checked","true"==n),$("#command-modal").modal()}function n(d){var o=$("#editKeyword_"+d.replace(/[^a-zA-Z0-9_]/g,"_SPC_")).val();o.length>0&&sendDBUpdate("discord_keyword","discordKeywords",d,o),setTimeout(function(){e()},TIMEOUT_WAIT_TIME)}function t(d){$("#removeKeyword_"+d.replace(/[^a-zA-Z0-9_]/g,"_SPC_")).html('<i style="color: #6136b1" class="fa fa-spinner fa-spin"/>'),sendDBDelete("discord_keyword","discordKeywords",d),setTimeout(function(){e()},TIMEOUT_WAIT_TIME)}function r(){var d=$("#custom-keyword").val(),o=$("#custom-keyword-value").val();d.length>0&&o.length>0&&sendDBUpdate("discord_keyword","discordKeywords",d,o),$("#custom-keyword").val(""),$("#custom-keyword-value").val(""),setTimeout(function(){e()},TIMEOUT_WAIT_TIME)}function i(){var d=$("#discordSlotRewards0Input").val(),o=$("#discordSlotRewards1Input").val(),a=$("#discordSlotRewards2Input").val(),s=$("#discordSlotRewards3Input").val(),l=$("#discordSlotRewards4Input").val();d.length>0&&o.length>0&&a.length>0&&s.length>0&&l.length>0&&(sendDBUpdate("slotRewards0","discordSlotMachineReward","reward_0",d),sendDBUpdate("slotRewards1","discordSlotMachineReward","reward_1",o),sendDBUpdate("slotRewards2","discordSlotMachineReward","reward_2",a),sendDBUpdate("slotRewards3","discordSlotMachineReward","reward_3",s),sendDBUpdate("slotRewards4","discordSlotMachineReward","reward_4",l),setTimeout(function(){e(),sendWSEvent("discord","./discord/games/slotMachine.js",null,null)},TIMEOUT_WAIT_TIME))}function c(){var d=$("#slotEmoji0Input").val(),o=$("#slotEmoji1Input").val(),a=$("#slotEmoji2Input").val(),s=$("#slotEmoji3Input").val(),l=$("#slotEmoji4Input").val();d.length>0&&o.length>0&&a.length>0&&s.length>0&&l.length>0&&(sendDBUpdate("slotEmojis0","discordSlotMachineEmojis","emoji_0",d),sendDBUpdate("slotEmojis1","discordSlotMachineEmojis","emoji_1",o),sendDBUpdate("slotEmojis2","discordSlotMachineEmojis","emoji_2",a),sendDBUpdate("slotEmojis3","discordSlotMachineEmojis","emoji_3",s),sendDBUpdate("slotEmojis4","discordSlotMachineEmojis","emoji_4",l),setTimeout(function(){e(),sendWSEvent("discord","./discord/games/slotMachine.js",null,null)},TIMEOUT_WAIT_TIME))}function m(){var d=$("#discordRollRewards0Input").val(),o=$("#discordRollRewards1Input").val(),a=$("#discordRollRewards2Input").val(),s=$("#discordRollRewards3Input").val(),l=$("#discordRollRewards4Input").val(),n=$("#discordRollRewards5Input").val();d.length>0&&o.length>0&&a.length>0&&s.length>0&&l.length>0&&n.length>0&&(sendDBUpdate("rollRewards0","discordRollReward","rewards_0",d),sendDBUpdate("rollRewards1","discordRollReward","rewards_1",o),sendDBUpdate("rollRewards2","discordRollReward","rewards_2",a),sendDBUpdate("rollRewards3","discordRollReward","rewards_3",s),sendDBUpdate("rollRewards4","discordRollReward","rewards_4",l),sendDBUpdate("rollRewards5","discordRollReward","rewards_5",n),setTimeout(function(){e(),sendWSEvent("discord","./discord/games/roll.js",null,null)},TIMEOUT_WAIT_TIME))}var u,v=[];v.false='<i  class="fa fa-circle text-warning" />',v.true='<i  class="fa fa-circle text-success" />',$("#discordPanel").load("/panel/discord.html");var p=setInterval(function(){if(isConnected&&TABS_INITIALIZED){var d=$("#tabs").tabs("option","active");18==d&&(e(),clearInterval(p))}},INITIAL_WAIT_TIME);setInterval(function(){var d=$("#tabs").tabs("option","active");18==d&&isConnected&&!isInputFocus()&&(newPanelAlert("Refreshing Discord Data","success",1e3),e())},3e4),$.updateDiscordTable=o,$.updateDiscordCommand=s,$.openCommandModal=l,$.discordOnMessage=d,$.discordDoQuery=e,$.editKeyword=n,$.removeKeyword=t,$.addKeyword=r,$.setDiscordSlotRewards=i,$.setSlotEmojis=c,$.setDiscordRollRewards=m})();