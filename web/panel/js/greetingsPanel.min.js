(function(){function e(e){var t;try{t=JSON.parse(e.data)}catch(e){return}if(panelHasQuery(t)){var n="",a="";if(panelCheckQuery(t,"greetings_greeting"))for(idx in t.results)n=t.results[idx].key,a=t.results[idx].value,panelMatch(n,"autoGreetEnabled")&&(l=a,$("#globalGreetings").html(i[a])),panelMatch(n,"cooldown")&&$("#greetingCooldownInput").val(a/36e5);if(panelCheckQuery(t,"greetings_followReward")&&$("#followerRewardInput").val(t.results.followReward),panelCheckQuery(t,"greetings_followMessage")&&$("#followerGreetingInput").val(t.results.followMessage),panelCheckQuery(t,"greetings_followToggle")&&(followToggle=t.results.followToggle,$("#followerGreetings").html(i[t.results.followToggle])),panelCheckQuery(t,"greetings_followDelay")&&$("#followDelay").val(t.results.followDelay),panelCheckQuery(t,"greetings_donation"))for(idx in t.results)n=t.results[idx].key,a=t.results[idx].value,panelMatch(n,"announce")&&(u=a,$("#donationGreetings").html(i[a])),panelMatch(n,"donationGroup")&&(p=a,$("#donationGroup").html(i[a])),panelMatch(n,"donationGroupMin")&&$("#donationGroupMin").val(a),panelMatch(n,"reward")&&$("#donateRewardInput").val(a),panelMatch(n,"message")&&$("#donateGreetingInput").val(a);if(panelCheckQuery(t,"greetings_donationstreamtip"))for(idx in t.results)n=t.results[idx].key,a=t.results[idx].value,panelMatch(n,"announce")&&(d=a,$("#streamtipGreetings").html(i[a])),panelMatch(n,"donationGroup")&&(c=a,$("#streamtipdonationGroup").html(i[a])),panelMatch(n,"donationGroupMin")&&$("#streamtipdonationGroupMin").val(a),panelMatch(n,"reward")&&$("#streamtipdonateRewardInput").val(a),panelMatch(n,"message")&&$("#streamtipdonateGreetingInput").val(a);if(panelCheckQuery(t,"greetings_tipeeestream"))for(idx in t.results)n=t.results[idx].key,a=t.results[idx].value,panelMatch(n,"toggle")&&(h=a,$("#tipeeestreamGreetings").html(i[a])),panelMatch(n,"group")&&(f=a,$("#tipeeestreamdonationGroup").html(i[a])),panelMatch(n,"groupMin")&&$("#tipeeestreamdonationGroupMin").val(a),panelMatch(n,"reward")&&$("#tipeeestreamdonateRewardInput").val(a),panelMatch(n,"message")&&$("#tipeeestreamdonateGreetingInput").val(a);if(panelCheckQuery(t,"greetings_subscribers"))for(idx in t.results)n=t.results[idx].key,a=t.results[idx].value,panelMatch(n,"subscribeMessage")&&$("#subGreetingInput").val(a),panelMatch(n,"primeSubscribeMessage")&&$("#primeSubGreetingInput").val(a),panelMatch(n,"reSubscribeReward")&&$("#reSubRewardInput").val(a),panelMatch(n,"reSubscribeMessage")&&$("#resubGreetingInput").val(a),panelMatch(n,"subscriberWelcomeToggle")&&(o=a,$("#subscriptionGreetings").html(i[a])),panelMatch(n,"primeSubscriberWelcomeToggle")&&(b=a,$("#primeSubscriptionGreetings").html(i[a])),panelMatch(n,"reSubscriberWelcomeToggle")&&(g=a,$("#resubscriptionGreetings").html(i[a])),panelMatch(n,"subscribeReward")&&$("#subRewardInput").val(a),panelMatch(n,"resubEmote")&&$("#resubEmoteInput").val(a);if(panelCheckQuery(t,"greetings_gamewisp"))for(idx in t.results)n=t.results[idx].key,a=t.results[idx].value,panelMatch(n,"subscriberShowMessages")&&(m=a,$("#gameWispGreetings").html(i[a])),panelMatch(n,"subscribeMessage")&&$("#gwSubGreetingInput").val(a),panelMatch(n,"reSubscribeMessage")&&$("#gwResubGreetingInput").val(a),panelMatch(n,"tierUpMessage")&&$("#gwTierupGreetingInput").val(a),panelMatch(n,"subscribeReward")&&$("#gwSubRewardInput").val(a),panelMatch(n,"reSubscribeReward")&&$("#gwResubRewardInput").val(a);if(panelCheckQuery(t,"greetings_bits"))for(idx in t.results)n=t.results[idx].key,a=t.results[idx].value,panelMatch(n,"toggle")&&(T=a,$("#bitsToggle").html(i[a])),panelMatch(n,"message")&&$("#bitsMessage").val(a),panelMatch(n,"minimum")&&$("#bitsMinimum").val(a);if(panelCheckQuery(t,"greetings_gamewispTiers")){var s="",r="",M="<table class='table table-hover table-striped'>",_="<table class='table table-hover table-striped'>",I="<table class='table table-hover table-striped'>";for(idx in t.results)n=t.results[idx].key,a=t.results[idx].value,s=n[n.indexOf("_")+1],r="<tr >    <td>Tier "+s+'</td>    <td>        <input type="number" min="0" id="inline_'+n+'"               placeholder="'+a+'" value="'+a+'"               style="width: 8em" />        <button type="button" class="btn btn-info btn-fill btn-xs"                onclick="$.updateGWTierData(\''+n+'\')"><i class="fa fa-pencil" />        </button>    </td></tr>',n.startsWith("songrequest_")===!0&&(M+=r),n.startsWith("bonuspoints_")===!0&&(_+=r),n.startsWith("subbonuspoints_")===!0&&(I+=r);$("#gameWispSongRequests").html(M),$("#gameWispBonusPoints").html(_),$("#gameWispSubBonusPoints").html(I),handleInputFocus()}}}function t(){sendDBKeys("greetings_greeting","greeting"),sendDBQuery("greetings_followReward","settings","followReward"),sendDBQuery("greetings_followMessage","settings","followMessage"),sendDBQuery("greetings_followToggle","settings","followToggle"),sendDBQuery("greetings_followDelay","settings","followDelay"),sendDBKeys("greetings_donation","donations"),sendDBKeys("greetings_donationstreamtip","streamtip"),sendDBKeys("greetings_subscribers","subscribeHandler"),sendDBKeys("greetings_gamewisp","gameWispSubHandler"),sendDBKeys("greetings_gamewispTiers","gameWispTiers"),sendDBKeys("greetings_bits","bitsSettings"),sendDBKeys("greetings_tipeeestream","tipeeeStreamHandler")}function n(e){var n=$("#inline_"+e).val();n.length>0&&(sendDBUpdate("greetings_updateTier","gameWispTiers",e,n),setTimeout(function(){sendCommand("gamewisppanelupdate"),t()},TIMEOUT_WAIT_TIME))}function a(e,n){panelMatch(e,"greeting")&&($("#globalGreetings").html(r),"true"==l?sendDBUpdate("greetings_greeting","greeting","autoGreetEnabled","false"):sendDBUpdate("greetings_greeting","greeting","autoGreetEnabled","true"),setTimeout(function(){sendCommand("greetingspanelupdate")},TIMEOUT_WAIT_TIME)),panelMatch(e,"settings")&&($("#followerGreetings").html(r),"true"==followToggle?sendDBUpdate("greetings_greeting","settings","followToggle","false"):sendDBUpdate("greetings_greeting","settings","followToggle","true"),setTimeout(function(){sendCommand("followerpanelupdate")},TIMEOUT_WAIT_TIME)),panelMatch(e,"donations")&&($("#donationGreetings").html(r),"true"==u?sendDBUpdate("greetings_greeting","donations","announce","false"):sendDBUpdate("greetings_greeting","donations","announce","true"),setTimeout(function(){sendCommand("donationpanelupdate")},TIMEOUT_WAIT_TIME)),panelMatch(e,"streamtip")&&($("#streamtipGreetings").html(r),"true"==d?sendDBUpdate("greetings_greeting","streamtip","announce","false"):sendDBUpdate("greetings_greeting","streamtip","announce","true"),setTimeout(function(){sendCommand("donationpanelupdatestreamtip")},TIMEOUT_WAIT_TIME)),panelMatch(e,"tipeeestream")&&($("#tipeeestreamGreetings").html(r),"true"==h?sendDBUpdate("greetings_greeting","tipeeeStreamHandler","toggle","false"):sendDBUpdate("greetings_greeting","tipeeeStreamHandler","toggle","true"),setTimeout(function(){sendCommand("tipeeestreamreload")},TIMEOUT_WAIT_TIME)),panelMatch(e,"donationGroup")&&($("#donationGroup").html(r),"true"==p?sendDBUpdate("greetings_greeting","donations","donationGroup","false"):sendDBUpdate("greetings_greeting","donations","donationGroup","true"),setTimeout(function(){sendCommand("donationpanelupdate")},TIMEOUT_WAIT_TIME)),panelMatch(e,"streamtipdonationGroup")&&($("#streamtipdonationGroup").html(r),"true"==c?sendDBUpdate("greetings_greeting","streamtip","donationGroup","false"):sendDBUpdate("greetings_greeting","streamtip","donationGroup","true"),setTimeout(function(){sendCommand("donationpanelupdatestreamtip")},TIMEOUT_WAIT_TIME)),panelMatch(e,"tipeeestreamdonationGroup")&&($("#tipeeestreamdonationGroup").html(r),"true"==f?sendDBUpdate("greetings_greeting","tipeeeStreamHandler","group","false"):sendDBUpdate("greetings_greeting","tipeeeStreamHandler","group","true"),setTimeout(function(){sendCommand("tipeeestreamreload")},TIMEOUT_WAIT_TIME)),panelMatch(e,"subscribeHandler")&&panelMatch(n,"subscriberWelcomeToggle")&&($("#subscriptionGreetings").html(r),"true"==o?sendDBUpdate("greetings_greeting","subscribeHandler","subscriberWelcomeToggle","false"):sendDBUpdate("greetings_greeting","subscribeHandler","subscriberWelcomeToggle","true"),setTimeout(function(){sendCommand("subscriberpanelupdate")},TIMEOUT_WAIT_TIME)),panelMatch(e,"subscribeHandler")&&panelMatch(n,"primeSubscriberWelcomeToggle")&&($("#primeSubscriptionGreetings").html(r),"true"==b?sendDBUpdate("greetings_greeting","subscribeHandler","primeSubscriberWelcomeToggle","false"):sendDBUpdate("greetings_greeting","subscribeHandler","primeSubscriberWelcomeToggle","true"),setTimeout(function(){sendCommand("subscriberpanelupdate")},TIMEOUT_WAIT_TIME)),panelMatch(e,"subscribeHandler")&&panelMatch(n,"reSubscriberWelcomeToggle")&&($("#resubscriptionGreetings").html(r),"true"==g?sendDBUpdate("greetings_greeting","subscribeHandler","reSubscriberWelcomeToggle","false"):sendDBUpdate("greetings_greeting","subscribeHandler","reSubscriberWelcomeToggle","true"),setTimeout(function(){sendCommand("subscriberpanelupdate")},TIMEOUT_WAIT_TIME)),panelMatch(e,"bitsSettings")&&panelMatch(n,"toggle")&&($("#bitsToggle").html(r),"true"==T?sendDBUpdate("greetings_bits","bitsSettings","toggle","false"):sendDBUpdate("greetings_bits","bitsSettings","toggle","true"),setTimeout(function(){sendCommand("reloadbits")},TIMEOUT_WAIT_TIME)),panelMatch(e,"bitsSettings")&&panelMatch(n,"rewardMultToggle")&&($("#bitsRewardMultToggle").html(r),"true"==M?sendDBUpdate("greetings_bits","bitsSettings","rewardMultToggle","false"):sendDBUpdate("greetings_bits","bitsSettings","rewardMultToggle","true"),setTimeout(function(){sendCommand("reloadbits")},TIMEOUT_WAIT_TIME)),panelMatch(e,"gameWispSubHandler")&&($("#gameWispGreetings").html(r),"true"==m?sendDBUpdate("greetings_greeting","gameWispSubHandler","subscriberShowMessages","false"):sendDBUpdate("greetings_greeting","gameWispSubHandler","subscriberShowMessages","true"),setTimeout(function(){sendCommand("gamewisppanelupdate")},TIMEOUT_WAIT_TIME)),setTimeout(function(){t()},TIMEOUT_WAIT_TIME)}function s(e,n,a){var s=$("#"+e).val();return"greetingCooldownInput"==e&&s.length>0?(s=String(36e5*s),sendDBUpdate("greetings_update","greeting","cooldown",s),void setTimeout(function(){t(),sendCommand("greetingspanelupdate")},TIMEOUT_WAIT_TIME)):"followDelay"==a&&parseInt(s)<5?(document.getElementById(e).type="text",$("#"+e).val("Follow delay cannot be less than 5 seconds!"),void setTimeout(function(){t(),document.getElementById(e).type="number"},4*TIMEOUT_WAIT_TIME)):void(s.length>0&&(sendDBUpdate("greetings_update",n,a,s),panelMatch(n,"greeting")&&sendCommand("greetingspanelupdate"),panelMatch(n,"settings")&&sendCommand("followerpanelupdate"),panelMatch(n,"donations")&&sendCommand("donationpanelupdate"),panelMatch(n,"streamtip")&&sendCommand("donationpanelupdatestreamtip"),panelMatch(n,"subscribeHandler")&&sendCommand("subscriberpanelupdate"),panelMatch(n,"bitsSettings")&&sendCommand("reloadbits"),panelMatch(n,"tipeeeStreamHandler")&&sendCommand("tipeeestreamreload"),panelMatch(n,"gameWispSubHandler")&&sendCommand("gamewisppanelupdate"),setTimeout(function(){t()},2*TIMEOUT_WAIT_TIME)))}var r='<i  class="fa fa-spinner fa-spin" />',i=[];i.false='<i  class="fa fa-circle text-warning" />',i.true='<i  class="fa fa-circle text-success"/>';var l=!1,o=!1,g=!1,u=!1,d=!1,p=!1,c=!1,m=!1,b=!1,T=!1,M=!1,h=!1,f=!1;$("#greetingsPanel").load("/panel/greetings.html");var _=setInterval(function(){if(isConnected&&TABS_INITIALIZED){var e=$("#tabs").tabs("option","active");8==e&&(t(),clearInterval(_))}},INITIAL_WAIT_TIME);setInterval(function(){var e=$("#tabs").tabs("option","active");8==e&&isConnected&&!isInputFocus()&&(newPanelAlert("Refreshing Greeting Data","success",1e3),t())},3e4),$.greetingsOnMessage=e,$.greetingsDoQuery=t,$.toggleGreetings=a,$.updateGreetingData=s,$.updateGWTierData=n})();